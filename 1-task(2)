#ПЯТНАШКИ
from random import randint as r

def check():
    global field
    global impossible_moves
    global command
    global gap
    if gap < 4:
        impossible_moves.append('S') #верхняя строка
    if gap % 4 == 0:
        impossible_moves.append('D') #левый столбец
    if gap > 11:
        impossible_moves.append('W') #нижняя строка
    if (gap + 1) % 4 == 0:
        impossible_moves.append('A') #правый столбец
    if command in 'WASD' and command not in impossible_moves:
        return True
    else:
        return False
    
def movement():
    global field
    global gap
    if command == 'W':
        field[gap], field[gap + 4] = field[gap + 4], field[gap]
    if command == 'A':
        field[gap], field[gap + 1] = field[gap + 1], field[gap]
    if command == 'S':
        field[gap], field[gap - 4] = field[gap - 4], field[gap]
    if command == 'D':
        field[gap], field[gap - 1] = field[gap - 1], field[gap]
            
def graph():
    global field
    print('\n')
    for j in range(4):
        print(f'{field[j * 4]}   {field[1 + j * 4]}   {field[2 + j * 4]}   {field[3 + j * 4]}')
    print('\n')

field = [''] * 16
win = [i for i in range(1,15)]
win.append(0)

i = 0
while i < 16:
    x = r(0 , 15)
    if x not in field:
        field[i] = x
        i += 1

print("Управление - WASD, в пустую клетку передвигается пятнашка. Ноль - пустая клетка")     

graph()
moves = 0
while field != win:
    moves += 1
    command = input(f'Ход {moves}: ')
    impossible_moves = []
    gap = field.index(0)
    instruction = check()
    if instruction:
        movement()
    else:
        print('Невозможно сделать такой ход или неправильный формат ввода!')
        moves -= 1
    graph()
print(f'Вы выиграли за {moves} ходов!')
